/*! For license information please see bundle.umd.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.erba=t():e.erba=t()}(this,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r:e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}},t={};e.r(t),e.d(t,{default:()=>Pe});var n,r=function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)};function o(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,a=n.call(e),i=[];try{for(;(void 0===t||t-- >0)&&!(r=a.next()).done;)i.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=a.return)&&n.call(a)}finally{if(o)throw o.error}}return i}function i(e,t,n){if(n||2===arguments.length)for(var r,o=0,a=t.length;o<a;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}function s(e){var t,n=null===(t=e)||void 0===t?void 0:t.host;return Boolean(n&&n.shadowRoot&&n.shadowRoot===e)}function u(e){var t=e.maskInputOptions,n=e.tagName,r=e.type,o=e.value,a=e.maskInputFn,i=o||"";return(t[n.toLowerCase()]||t[r])&&(i=a?a(i):"*".repeat(i.length)),i}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(n||(n={}));var l,c,d="__rrweb_original__",p=1,f=new RegExp("[^a-z0-9-_:]"),h=-2;function m(e){try{var t=e.rules||e.cssRules;return t?Array.from(t).map(v).join(""):null}catch(e){return null}}function v(e){var t=e.cssText;if(function(e){return"styleSheet"in e}(e))try{t=m(e.styleSheet)||t}catch(e){}return t}var y=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,g=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,b=/^(data:)([^,]*),(.*)/i;function S(e,t){return(e||"").replace(y,(function(e,n,r,o,a,i){var s,u=r||a||i,l=n||o||"";if(!u)return e;if(!g.test(u))return"url("+l+u+l+")";if(b.test(u))return"url("+l+u+l+")";if("/"===u[0])return"url("+l+(((s=t).indexOf("//")>-1?s.split("/").slice(0,3).join("/"):s.split("/")[0]).split("?")[0]+u)+l+")";var c=t.split("/"),d=u.split("/");c.pop();for(var p=0,f=d;p<f.length;p++){var h=f[p];"."!==h&&(".."===h?c.pop():c.push(h))}return"url("+l+c.join("/")+l+")"}))}var C=/^[^ \t\n\r\u000c]+/,k=/^[, \t\n\r\u000c]+/;function w(e,t){if(!t||""===t.trim())return t;var n=e.createElement("a");return n.href=t,n.href}function I(){var e=document.createElement("a");return e.href="",e.href}function x(e,t,n,r){return"src"===n||"href"===n&&r||"xlink:href"===n&&r&&"#"!==r[0]?w(e,r):"background"!==n||!r||"table"!==t&&"td"!==t&&"th"!==t?"srcset"===n&&r?function(e,t){if(""===t.trim())return t;var n=0;function r(e){var r,o=e.exec(t.substring(n));return o?(r=o[0],n+=r.length,r):""}for(var o=[];r(k),!(n>=t.length);){var a=r(C);if(","===a.slice(-1))a=w(e,a.substring(0,a.length-1)),o.push(a);else{var i="";a=w(e,a);for(var s=!1;;){var u=t.charAt(n);if(""===u){o.push((a+i).trim());break}if(s)")"===u&&(s=!1);else{if(","===u){n+=1,o.push((a+i).trim());break}"("===u&&(s=!0)}i+=u,n+=1}}}return o.join(", ")}(e,r):"style"===n&&r?S(r,I()):"object"===t&&"data"===n&&r?w(e,r):r:w(e,r)}function M(e,t,n){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var r=0;r<e.classList.length;r++){var o=e.classList[r];if(t.test(o))return!0}return!(!n||!e.matches(n))||M(e.parentNode,t,n)}return e.nodeType,e.TEXT_NODE,M(e.parentNode,t,n)}function T(e){return void 0===e?"":e.toLowerCase()}function E(e,t){var r,o=t.doc,a=t.map,i=t.blockClass,v=t.blockSelector,y=t.maskTextClass,g=t.maskTextSelector,b=t.skipChild,C=void 0!==b&&b,k=t.inlineStylesheet,w=void 0===k||k,O=t.maskInputOptions,R=void 0===O?{}:O,N=t.maskTextFn,_=t.maskInputFn,L=t.slimDOMOptions,D=t.dataURLOptions,F=void 0===D?{}:D,A=t.inlineImages,P=void 0!==A&&A,z=t.recordCanvas,W=void 0!==z&&z,j=t.onSerialize,U=t.onIframeLoad,G=t.iframeLoadTimeout,H=void 0===G?5e3:G,V=t.keepIframeSrcFn,q=void 0===V?function(){return!1}:V,B=t.preserveWhiteSpace,X=void 0===B||B,Y=function(e,t){var r,o,a,i,s=t.doc,p=t.blockClass,h=t.blockSelector,v=t.maskTextClass,y=t.maskTextSelector,g=t.inlineStylesheet,b=t.maskInputOptions,C=void 0===b?{}:b,k=t.maskTextFn,w=t.maskInputFn,T=t.dataURLOptions,E=void 0===T?{}:T,O=t.inlineImages,R=t.recordCanvas,N=t.keepIframeSrcFn;if(s.__sn){var _=s.__sn.id;o=1===_?void 0:_}switch(e.nodeType){case e.DOCUMENT_NODE:return"CSS1Compat"!==e.compatMode?{type:n.Document,childNodes:[],compatMode:e.compatMode,rootId:o}:{type:n.Document,childNodes:[],rootId:o};case e.DOCUMENT_TYPE_NODE:return{type:n.DocumentType,name:e.name,publicId:e.publicId,systemId:e.systemId,rootId:o};case e.ELEMENT_NODE:for(var L=function(e,t,n){if("string"==typeof t){if(e.classList.contains(t))return!0}else for(var r=0;r<e.classList.length;r++){var o=e.classList[r];if(t.test(o))return!0}return!!n&&e.matches(n)}(e,p,h),D=function(e){if(e instanceof HTMLFormElement)return"form";var t=e.tagName.toLowerCase().trim();return f.test(t)?"div":t}(e),F={},A=0,P=Array.from(e.attributes);A<P.length;A++){var z=P[A],W=z.name,j=z.value;F[W]=x(s,D,W,j)}if("link"===D&&g){var U=Array.from(s.styleSheets).find((function(t){return t.href===e.href})),G=null;U&&(G=m(U)),G&&(delete F.rel,delete F.href,F._cssText=S(G,U.href))}if("style"===D&&e.sheet&&!(e.innerText||e.textContent||"").trim().length&&(G=m(e.sheet))&&(F._cssText=S(G,I())),"input"!==D&&"textarea"!==D&&"select"!==D||(j=e.value,"radio"!==F.type&&"checkbox"!==F.type&&"submit"!==F.type&&"button"!==F.type&&j?F.value=u({type:F.type,tagName:D,value:j,maskInputOptions:C,maskInputFn:w}):e.checked&&(F.checked=e.checked)),"option"===D&&(e.selected&&!C.select?F.selected=!0:delete F.selected),"canvas"===D&&R)if("2d"===e.__context)(function(e){var t=e.getContext("2d");if(!t)return!0;for(var n=0;n<e.width;n+=50)for(var r=0;r<e.height;r+=50){var o=t.getImageData,a=d in o?o[d]:o;if(new Uint32Array(a.call(t,n,r,Math.min(50,e.width-n),Math.min(50,e.height-r)).data.buffer).some((function(e){return 0!==e})))return!1}return!0})(e)||(F.rr_dataURL=e.toDataURL(E.type,E.quality));else if(!("__context"in e)){var H=e.toDataURL(E.type,E.quality),V=document.createElement("canvas");V.width=e.width,V.height=e.height,H!==V.toDataURL(E.type,E.quality)&&(F.rr_dataURL=H)}if("img"===D&&O){l||(l=s.createElement("canvas"),c=l.getContext("2d"));var q=e,B=q.crossOrigin;q.crossOrigin="anonymous";var X=function(){try{l.width=q.naturalWidth,l.height=q.naturalHeight,c.drawImage(q,0,0),F.rr_dataURL=l.toDataURL(E.type,E.quality)}catch(e){console.warn("Cannot inline img src="+q.currentSrc+"! Error: "+e)}B?F.crossOrigin=B:delete F.crossOrigin};q.complete&&0!==q.naturalWidth?X():q.onload=X}if("audio"!==D&&"video"!==D||(F.rr_mediaState=e.paused?"paused":"played",F.rr_mediaCurrentTime=e.currentTime),e.scrollLeft&&(F.rr_scrollLeft=e.scrollLeft),e.scrollTop&&(F.rr_scrollTop=e.scrollTop),L){var Y=e.getBoundingClientRect(),K=Y.width,J=Y.height;F={class:F.class,rr_width:K+"px",rr_height:J+"px"}}return"iframe"!==D||N(F.src)||(e.contentDocument||(F.rr_src=F.src),delete F.src),{type:n.Element,tagName:D,attributes:F,childNodes:[],isSVG:(i=e,Boolean("svg"===i.tagName||i.ownerSVGElement)||void 0),needBlock:L,rootId:o};case e.TEXT_NODE:var Z=e.parentNode&&e.parentNode.tagName,$=e.textContent,Q="STYLE"===Z||void 0,ee="SCRIPT"===Z||void 0;if(Q&&$){try{e.nextSibling||e.previousSibling||(null===(r=e.parentNode.sheet)||void 0===r?void 0:r.cssRules)&&($=(a=e.parentNode.sheet).cssRules?Array.from(a.cssRules).map((function(e){return e.cssText||""})).join(""):"")}catch(t){console.warn("Cannot get CSS styles from text's parentNode. Error: "+t,e)}$=S($,I())}return ee&&($="SCRIPT_PLACEHOLDER"),!Q&&!ee&&M(e,v,y)&&$&&($=k?k($):$.replace(/[\S]/g,"*")),{type:n.Text,textContent:$||"",isStyle:Q,rootId:o};case e.CDATA_SECTION_NODE:return{type:n.CDATA,textContent:"",rootId:o};case e.COMMENT_NODE:return{type:n.Comment,textContent:e.textContent||"",rootId:o};default:return!1}}(e,{doc:o,blockClass:i,blockSelector:v,maskTextClass:y,maskTextSelector:g,inlineStylesheet:w,maskInputOptions:R,maskTextFn:N,maskInputFn:_,dataURLOptions:F,inlineImages:P,recordCanvas:W,keepIframeSrcFn:q});if(!Y)return console.warn(e,"not serialized"),null;r="__sn"in e?e.__sn.id:!function(e,t){if(t.comment&&e.type===n.Comment)return!0;if(e.type===n.Element){if(t.script&&("script"===e.tagName||"link"===e.tagName&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===e.tagName&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")))return!0;if(t.headFavicon&&("link"===e.tagName&&"shortcut icon"===e.attributes.rel||"meta"===e.tagName&&(T(e.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===T(e.attributes.name)||"icon"===T(e.attributes.rel)||"apple-touch-icon"===T(e.attributes.rel)||"shortcut icon"===T(e.attributes.rel))))return!0;if("meta"===e.tagName){if(t.headMetaDescKeywords&&T(e.attributes.name).match(/^description|keywords$/))return!0;if(t.headMetaSocial&&(T(e.attributes.property).match(/^(og|twitter|fb):/)||T(e.attributes.name).match(/^(og|twitter):/)||"pinterest"===T(e.attributes.name)))return!0;if(t.headMetaRobots&&("robots"===T(e.attributes.name)||"googlebot"===T(e.attributes.name)||"bingbot"===T(e.attributes.name)))return!0;if(t.headMetaHttpEquiv&&void 0!==e.attributes["http-equiv"])return!0;if(t.headMetaAuthorship&&("author"===T(e.attributes.name)||"generator"===T(e.attributes.name)||"framework"===T(e.attributes.name)||"publisher"===T(e.attributes.name)||"progid"===T(e.attributes.name)||T(e.attributes.property).match(/^article:/)||T(e.attributes.property).match(/^product:/)))return!0;if(t.headMetaVerification&&("google-site-verification"===T(e.attributes.name)||"yandex-verification"===T(e.attributes.name)||"csrf-token"===T(e.attributes.name)||"p:domain_verify"===T(e.attributes.name)||"verify-v1"===T(e.attributes.name)||"verification"===T(e.attributes.name)||"shopify-checkout-api-token"===T(e.attributes.name)))return!0}}return!1}(Y,L)&&(X||Y.type!==n.Text||Y.isStyle||Y.textContent.replace(/^\s+|\s+$/gm,"").length)?p++:h;var K=Object.assign(Y,{id:r});if(e.__sn=K,r===h)return null;a[r]=e,j&&j(e);var J=!C;if(K.type===n.Element&&(J=J&&!K.needBlock,delete K.needBlock,e.shadowRoot&&(K.isShadowHost=!0)),(K.type===n.Document||K.type===n.Element)&&J){L.headWhitespace&&Y.type===n.Element&&"head"===Y.tagName&&(X=!1);for(var Z={doc:o,map:a,blockClass:i,blockSelector:v,maskTextClass:y,maskTextSelector:g,skipChild:C,inlineStylesheet:w,maskInputOptions:R,maskTextFn:N,maskInputFn:_,slimDOMOptions:L,dataURLOptions:F,inlineImages:P,recordCanvas:W,preserveWhiteSpace:X,onSerialize:j,onIframeLoad:U,iframeLoadTimeout:H,keepIframeSrcFn:q},$=0,Q=Array.from(e.childNodes);$<Q.length;$++)(ne=E(Q[$],Z))&&K.childNodes.push(ne);if(function(e){return e.nodeType===e.ELEMENT_NODE}(e)&&e.shadowRoot)for(var ee=0,te=Array.from(e.shadowRoot.childNodes);ee<te.length;ee++){var ne;(ne=E(te[ee],Z))&&(ne.isShadow=!0,K.childNodes.push(ne))}}return e.parentNode&&s(e.parentNode)&&(K.isShadow=!0),K.type===n.Element&&"iframe"===K.tagName&&function(e,t,n){var r=e.contentWindow;if(r){var o,a=!1;try{o=r.document.readyState}catch(e){return}if("complete"===o){var i="about:blank";r.location.href===i&&e.src!==i&&""!==e.src?e.addEventListener("load",t):setTimeout(t,0)}else{var s=setTimeout((function(){a||(t(),a=!0)}),n);e.addEventListener("load",(function(){clearTimeout(s),a=!0,t()}))}}}(e,(function(){var t=e.contentDocument;if(t&&U){var n=E(t,{doc:t,map:a,blockClass:i,blockSelector:v,maskTextClass:y,maskTextSelector:g,skipChild:!1,inlineStylesheet:w,maskInputOptions:R,maskTextFn:N,maskInputFn:_,slimDOMOptions:L,dataURLOptions:F,inlineImages:P,recordCanvas:W,preserveWhiteSpace:X,onSerialize:j,onIframeLoad:U,iframeLoadTimeout:H,keepIframeSrcFn:q});n&&U(e,n)}}),H),K}var O,R,N,_,L,D;function F(e,t,n){void 0===n&&(n=document);var r={capture:!0,passive:!0};return n.addEventListener(e,t,r),function(){return n.removeEventListener(e,t,r)}}new RegExp(/([^\\]):hover/.source,"g"),function(e){e[e.DomContentLoaded=0]="DomContentLoaded",e[e.Load=1]="Load",e[e.FullSnapshot=2]="FullSnapshot",e[e.IncrementalSnapshot=3]="IncrementalSnapshot",e[e.Meta=4]="Meta",e[e.Custom=5]="Custom",e[e.Plugin=6]="Plugin"}(O||(O={})),function(e){e[e.Mutation=0]="Mutation",e[e.MouseMove=1]="MouseMove",e[e.MouseInteraction=2]="MouseInteraction",e[e.Scroll=3]="Scroll",e[e.ViewportResize=4]="ViewportResize",e[e.Input=5]="Input",e[e.TouchMove=6]="TouchMove",e[e.MediaInteraction=7]="MediaInteraction",e[e.StyleSheetRule=8]="StyleSheetRule",e[e.CanvasMutation=9]="CanvasMutation",e[e.Font=10]="Font",e[e.Log=11]="Log",e[e.Drag=12]="Drag",e[e.StyleDeclaration=13]="StyleDeclaration"}(R||(R={})),function(e){e[e.MouseUp=0]="MouseUp",e[e.MouseDown=1]="MouseDown",e[e.Click=2]="Click",e[e.ContextMenu=3]="ContextMenu",e[e.DblClick=4]="DblClick",e[e.Focus=5]="Focus",e[e.Blur=6]="Blur",e[e.TouchStart=7]="TouchStart",e[e.TouchMove_Departed=8]="TouchMove_Departed",e[e.TouchEnd=9]="TouchEnd",e[e.TouchCancel=10]="TouchCancel"}(N||(N={})),function(e){e[e["2D"]=0]="2D",e[e.WebGL=1]="WebGL",e[e.WebGL2=2]="WebGL2"}(_||(_={})),function(e){e[e.Play=0]="Play",e[e.Pause=1]="Pause",e[e.Seeked=2]="Seeked",e[e.VolumeChange=3]="VolumeChange"}(L||(L={})),function(e){e.Start="start",e.Pause="pause",e.Resume="resume",e.Resize="resize",e.Finish="finish",e.FullsnapshotRebuilded="fullsnapshot-rebuilded",e.LoadStylesheetStart="load-stylesheet-start",e.LoadStylesheetEnd="load-stylesheet-end",e.SkipStart="skip-start",e.SkipEnd="skip-end",e.MouseInteraction="mouse-interaction",e.EventCast="event-cast",e.CustomEvent="custom-event",e.Flush="flush",e.StateChange="state-change",e.PlayBack="play-back"}(D||(D={}));var A="Please stop import mirror directly. Instead of that,\r\nnow you can use replayer.getMirror() to access the mirror instance of a replayer,\r\nor you can use record.mirror to access the mirror instance during recording.",P={map:{},getId:function(){return console.error(A),-1},getNode:function(){return console.error(A),null},removeNodeFromMap:function(){console.error(A)},has:function(){return console.error(A),!1},reset:function(){console.error(A)}};function z(e,t,n){void 0===n&&(n={});var r=null,o=0;return function(a){var i=Date.now();o||!1!==n.leading||(o=i);var s=t-(i-o),u=this,l=arguments;s<=0||s>t?(r&&(clearTimeout(r),r=null),o=i,e.apply(u,l)):r||!1===n.trailing||(r=setTimeout((function(){o=!1===n.leading?0:Date.now(),r=null,e.apply(u,l)}),s))}}function W(e,t,n,r,o){void 0===o&&(o=window);var a=o.Object.getOwnPropertyDescriptor(e,t);return o.Object.defineProperty(e,t,r?n:{set:function(e){var t=this;setTimeout((function(){n.set.call(t,e)}),0),a&&a.set&&a.set.call(this,e)}}),function(){return W(e,t,a||{},!0)}}function j(e,t,n){try{if(!(t in e))return function(){};var r=e[t],o=n(r);return"function"==typeof o&&(o.prototype=o.prototype||{},Object.defineProperties(o,{__rrweb_original__:{enumerable:!1,value:r}})),e[t]=o,function(){e[t]=r}}catch(e){return function(){}}}function U(){return window.innerHeight||document.documentElement&&document.documentElement.clientHeight||document.body&&document.body.clientHeight}function G(){return window.innerWidth||document.documentElement&&document.documentElement.clientWidth||document.body&&document.body.clientWidth}function H(e,t){if(!e)return!1;if(e.nodeType===e.ELEMENT_NODE){var n=!1;if("string"==typeof t){if(void 0!==e.closest)return null!==e.closest("."+t);n=e.classList.contains(t)}else e.classList.forEach((function(e){t.test(e)&&(n=!0)}));return n||H(e.parentNode,t)}return e.nodeType,e.TEXT_NODE,H(e.parentNode,t)}function V(e){return"__sn"in e&&e.__sn.id===h}function q(e,t){if(s(e))return!1;var n=t.getId(e);return!t.has(n)||(!e.parentNode||e.parentNode.nodeType!==e.DOCUMENT_NODE)&&(!e.parentNode||q(e.parentNode,t))}function B(e){return Boolean(e.changedTouches)}function X(e){return"__sn"in e&&e.__sn.type===n.Element&&"iframe"===e.__sn.tagName}function Y(e){return Boolean(null==e?void 0:e.shadowRoot)}function K(e){return"__ln"in e}"undefined"!=typeof window&&window.Proxy&&window.Reflect&&(P=new Proxy(P,{get:function(e,t,n){return"map"===t&&console.error(A),Reflect.get(e,t,n)}})),function(){function e(){this.reset()}e.prototype.add=function(e){var t=this.indexes.get(e.parentId),n={id:e.node.id,mutation:e,children:[],texts:[],attributes:[]};t?(n.parent=t,t.children[n.id]=n):this.tree[n.id]=n,this.indexes.set(n.id,n)},e.prototype.remove=function(e,t){var n=this,r=this.indexes.get(e.parentId),o=this.indexes.get(e.id),a=function(e){n.removeIdSet.add(e);var r=t.getNode(e);null==r||r.childNodes.forEach((function(e){"__sn"in e&&a(e.__sn.id)}))},i=function(t){n.removeIdSet.add(t.id),Object.values(t.children).forEach((function(e){return i(e)}));var r=n.indexes.get(t.id);if(r){var o=r.parent;o&&(delete r.parent,delete o.children[r.id],n.indexes.delete(e.id))}};o?r?(delete o.parent,delete r.children[o.id],this.indexes.delete(e.id),i(o)):(delete this.tree[o.id],this.indexes.delete(o.id),i(o)):(this.removeNodeMutations.push(e),a(e.id))},e.prototype.text=function(e){var t=this.indexes.get(e.id);t?t.texts.push(e):this.textMutations.push(e)},e.prototype.attribute=function(e){var t=this.indexes.get(e.id);t?t.attributes.push(e):this.attributeMutations.push(e)},e.prototype.scroll=function(e){this.scrollMap.set(e.id,e)},e.prototype.input=function(e){this.inputMap.set(e.id,e)},e.prototype.flush=function(){var e,t,n,r,a=this,i=this,s=i.tree,u=i.removeNodeMutations,l=i.textMutations,c=i.attributeMutations,d={source:R.Mutation,removes:u,texts:l,attributes:c,adds:[]},p=function(e,t){t&&a.removeIdSet.add(e.id),d.texts=d.texts.concat(t?[]:e.texts).filter((function(e){return!a.removeIdSet.has(e.id)})),d.attributes=d.attributes.concat(t?[]:e.attributes).filter((function(e){return!a.removeIdSet.has(e.id)})),a.removeIdSet.has(e.id)||a.removeIdSet.has(e.mutation.parentId)||t?Object.values(e.children).forEach((function(e){return p(e,!0)})):(d.adds.push(e.mutation),e.children&&Object.values(e.children).forEach((function(e){return p(e,!1)})))};Object.values(s).forEach((function(e){return p(e,!1)}));try{for(var f=o(this.scrollMap.keys()),h=f.next();!h.done;h=f.next()){var m=h.value;this.removeIdSet.has(m)&&this.scrollMap.delete(m)}}catch(t){e={error:t}}finally{try{h&&!h.done&&(t=f.return)&&t.call(f)}finally{if(e)throw e.error}}try{for(var v=o(this.inputMap.keys()),y=v.next();!y.done;y=v.next())m=y.value,this.removeIdSet.has(m)&&this.inputMap.delete(m)}catch(e){n={error:e}}finally{try{y&&!y.done&&(r=v.return)&&r.call(v)}finally{if(n)throw n.error}}var g=new Map(this.scrollMap),b=new Map(this.inputMap);return this.reset(),{mutationData:d,scrollMap:g,inputMap:b}},e.prototype.reset=function(){this.tree=[],this.indexes=new Map,this.removeNodeMutations=[],this.textMutations=[],this.attributeMutations=[],this.removeIdSet=new Set,this.scrollMap=new Map,this.inputMap=new Map},e.prototype.idRemoved=function(e){return this.removeIdSet.has(e)}}();var J=function(){function e(){this.length=0,this.head=null}return e.prototype.get=function(e){if(e>=this.length)throw new Error("Position outside of list range");for(var t=this.head,n=0;n<e;n++)t=(null==t?void 0:t.next)||null;return t},e.prototype.addNode=function(e){var t={value:e,previous:null,next:null};if(e.__ln=t,e.previousSibling&&K(e.previousSibling)){var n=e.previousSibling.__ln.next;t.next=n,t.previous=e.previousSibling.__ln,e.previousSibling.__ln.next=t,n&&(n.previous=t)}else e.nextSibling&&K(e.nextSibling)&&e.nextSibling.__ln.previous?(n=e.nextSibling.__ln.previous,t.previous=n,t.next=e.nextSibling.__ln,e.nextSibling.__ln.previous=t,n&&(n.next=t)):(this.head&&(this.head.previous=t),t.next=this.head,this.head=t);this.length++},e.prototype.removeNode=function(e){var t=e.__ln;this.head&&(t.previous?(t.previous.next=t.next,t.next&&(t.next.previous=t.previous)):(this.head=t.next,this.head&&(this.head.previous=null)),e.__ln&&delete e.__ln,this.length--)},e}(),Z=function(e,t){return"".concat(e,"@").concat(t)};function $(e){return"__sn"in e}function Q(e,t){e.delete(t),t.childNodes.forEach((function(t){return Q(e,t)}))}function ee(e,t,n){var r=t.parentNode;if(!r)return!1;var o=n.getId(r);return!!e.some((function(e){return e.id===o}))||ee(e,r,n)}function te(e,t){var n=t.parentNode;return!!n&&(!!e.has(n)||te(e,n))}const ne=function(){function e(){var e=this;this.frozen=!1,this.locked=!1,this.texts=[],this.attributes=[],this.removes=[],this.mapRemoves=[],this.movedMap={},this.addedSet=new Set,this.movedSet=new Set,this.droppedSet=new Set,this.processMutations=function(t){t.forEach(e.processMutation),e.emit()},this.emit=function(){var t,n,r,a;if(!e.frozen&&!e.locked){for(var i=[],u=new J,l=function(t){for(var n=t,r=h;r===h;)r=(n=n&&n.nextSibling)&&e.mirror.getId(n);return r},c=function(t){for(var n,r,o,a,c,d=t.getRootNode?null===(n=t.getRootNode())||void 0===n?void 0:n.host:null,p=d;null===(o=null===(r=null==p?void 0:p.getRootNode)||void 0===r?void 0:r.call(p))||void 0===o?void 0:o.host;)p=(null===(c=null===(a=null==p?void 0:p.getRootNode)||void 0===a?void 0:a.call(p))||void 0===c?void 0:c.host)||null;var f=!(e.doc.contains(t)||null!==p&&e.doc.contains(p));if(t.parentNode&&!f){var h=s(t.parentNode)?e.mirror.getId(d):e.mirror.getId(t.parentNode),m=l(t);if(-1===h||-1===m)return u.addNode(t);var v=E(t,{doc:e.doc,map:e.mirror.map,blockClass:e.blockClass,blockSelector:e.blockSelector,maskTextClass:e.maskTextClass,maskTextSelector:e.maskTextSelector,skipChild:!0,inlineStylesheet:e.inlineStylesheet,maskInputOptions:e.maskInputOptions,maskTextFn:e.maskTextFn,maskInputFn:e.maskInputFn,slimDOMOptions:e.slimDOMOptions,recordCanvas:e.recordCanvas,inlineImages:e.inlineImages,onSerialize:function(n){X(n)&&e.iframeManager.addIframe(n),Y(t)&&e.shadowDomManager.addShadowRoot(t.shadowRoot,document)},onIframeLoad:function(t,n){e.iframeManager.attachIframe(t,n),e.shadowDomManager.observeAttachShadow(t)}});v&&i.push({parentId:h,nextId:m,node:v})}};e.mapRemoves.length;)e.mirror.removeNodeFromMap(e.mapRemoves.shift());try{for(var d=o(e.movedSet),p=d.next();!p.done;p=d.next()){var f=p.value;ee(e.removes,f,e.mirror)&&!e.movedSet.has(f.parentNode)||c(f)}}catch(e){t={error:e}}finally{try{p&&!p.done&&(n=d.return)&&n.call(d)}finally{if(t)throw t.error}}try{for(var m=o(e.addedSet),v=m.next();!v.done;v=m.next())f=v.value,te(e.droppedSet,f)||ee(e.removes,f,e.mirror)?te(e.movedSet,f)?c(f):e.droppedSet.add(f):c(f)}catch(e){r={error:e}}finally{try{v&&!v.done&&(a=m.return)&&a.call(m)}finally{if(r)throw r.error}}for(var y=null;u.length;){var g=null;if(y){var b=e.mirror.getId(y.value.parentNode),S=l(y.value);-1!==b&&-1!==S&&(g=y)}if(!g)for(var C=u.length-1;C>=0;C--){var k=u.get(C);if(k&&(b=e.mirror.getId(k.value.parentNode),S=l(k.value),-1!==b&&-1!==S)){g=k;break}}if(!g){for(;u.head;)u.removeNode(u.head.value);break}y=g.previous,u.removeNode(g.value),c(g.value)}var w={texts:e.texts.map((function(t){return{id:e.mirror.getId(t.node),value:t.value}})).filter((function(t){return e.mirror.has(t.id)})),attributes:e.attributes.map((function(t){return{id:e.mirror.getId(t.node),attributes:t.attributes}})).filter((function(t){return e.mirror.has(t.id)})),removes:e.removes,adds:i};(w.texts.length||w.attributes.length||w.removes.length||w.adds.length)&&(e.texts=[],e.attributes=[],e.removes=[],e.addedSet=new Set,e.movedSet=new Set,e.droppedSet=new Set,e.movedMap={},e.mutationCb(w))}},this.processMutation=function(t){var n,r,a,i;if(!V(t.target))switch(t.type){case"characterData":var l=t.target.textContent;H(t.target,e.blockClass)||l===t.oldValue||e.texts.push({value:M(t.target,e.maskTextClass,e.maskTextSelector)&&l?e.maskTextFn?e.maskTextFn(l):l.replace(/[\S]/g,"*"):l,node:t.target});break;case"attributes":var c=t.target;if(l=t.target.getAttribute(t.attributeName),"value"===t.attributeName&&(l=u({maskInputOptions:e.maskInputOptions,tagName:t.target.tagName,type:t.target.getAttribute("type"),value:l,maskInputFn:e.maskInputFn})),H(t.target,e.blockClass)||l===t.oldValue)return;var d=e.attributes.find((function(e){return e.node===t.target}));if(d||(d={node:t.target,attributes:{}},e.attributes.push(d)),"style"===t.attributeName){var p=e.doc.createElement("span");t.oldValue&&p.setAttribute("style",t.oldValue),void 0!==d.attributes.style&&null!==d.attributes.style||(d.attributes.style={});var f=d.attributes.style;try{for(var h=o(Array.from(c.style)),m=h.next();!m.done;m=h.next()){var v=m.value,y=c.style.getPropertyValue(v),g=c.style.getPropertyPriority(v);y===p.style.getPropertyValue(v)&&g===p.style.getPropertyPriority(v)||(f[v]=""===g?y:[y,g])}}catch(e){n={error:e}}finally{try{m&&!m.done&&(r=h.return)&&r.call(h)}finally{if(n)throw n.error}}try{for(var b=o(Array.from(p.style)),S=b.next();!S.done;S=b.next())v=S.value,""===c.style.getPropertyValue(v)&&(f[v]=!1)}catch(e){a={error:e}}finally{try{S&&!S.done&&(i=b.return)&&i.call(b)}finally{if(a)throw a.error}}}else d.attributes[t.attributeName]=x(e.doc,t.target.tagName,t.attributeName,l);break;case"childList":t.addedNodes.forEach((function(n){return e.genAdds(n,t.target)})),t.removedNodes.forEach((function(n){var r=e.mirror.getId(n),o=s(t.target)?e.mirror.getId(t.target.host):e.mirror.getId(t.target);H(t.target,e.blockClass)||V(n)||(e.addedSet.has(n)?(Q(e.addedSet,n),e.droppedSet.add(n)):e.addedSet.has(t.target)&&-1===r||q(t.target,e.mirror)||(e.movedSet.has(n)&&e.movedMap[Z(r,o)]?Q(e.movedSet,n):e.removes.push({parentId:o,id:r,isShadow:!!s(t.target)||void 0})),e.mapRemoves.push(n))}))}},this.genAdds=function(t,n){if(!n||!H(n,e.blockClass)){if($(t)){if(V(t))return;e.movedSet.add(t);var r=null;n&&$(n)&&(r=n.__sn.id),r&&(e.movedMap[Z(t.__sn.id,r)]=!0)}else e.addedSet.add(t),e.droppedSet.delete(t);H(t,e.blockClass)||t.childNodes.forEach((function(t){return e.genAdds(t)}))}}}return e.prototype.init=function(e){var t=this;["mutationCb","blockClass","blockSelector","maskTextClass","maskTextSelector","inlineStylesheet","maskInputOptions","maskTextFn","maskInputFn","recordCanvas","inlineImages","slimDOMOptions","doc","mirror","iframeManager","shadowDomManager","canvasManager"].forEach((function(n){t[n]=e[n]}))},e.prototype.freeze=function(){this.frozen=!0,this.canvasManager.freeze()},e.prototype.unfreeze=function(){this.frozen=!1,this.canvasManager.unfreeze(),this.emit()},e.prototype.isFrozen=function(){return this.frozen},e.prototype.lock=function(){this.locked=!0,this.canvasManager.lock()},e.prototype.unlock=function(){this.locked=!1,this.canvasManager.unlock(),this.emit()},e.prototype.reset=function(){this.shadowDomManager.reset(),this.canvasManager.reset()},e}();var re=[],oe="undefined"!=typeof CSSGroupingRule,ae="undefined"!=typeof CSSMediaRule,ie="undefined"!=typeof CSSSupportsRule,se="undefined"!=typeof CSSConditionRule;function ue(e){try{if("composedPath"in e){var t=e.composedPath();if(t.length)return t[0]}else if("path"in e&&e.path.length)return e.path[0];return e.target}catch(t){return e.target}}function le(e,t){var n,r,o=new ne;re.push(o),o.init(e);var a=window.MutationObserver||window.__rrMutationObserver,i=null===(r=null===(n=null===window||void 0===window?void 0:window.Zone)||void 0===n?void 0:n.__symbol__)||void 0===r?void 0:r.call(n,"MutationObserver");i&&window[i]&&(a=window[i]);var s=new a(o.processMutations.bind(o));return s.observe(t,{attributes:!0,attributeOldValue:!0,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0}),s}function ce(e){var t=e.scrollCb,n=e.doc,r=e.mirror,o=e.blockClass;return F("scroll",z((function(e){var a=ue(e);if(a&&!H(a,o)){var i=r.getId(a);if(a===n){var s=n.scrollingElement||n.documentElement;t({id:i,x:s.scrollLeft,y:s.scrollTop})}else t({id:i,x:a.scrollLeft,y:a.scrollTop})}}),e.sampling.scroll||100),n)}function de(e,t){var n=r({},e);return t||delete n.userTriggered,n}var pe=["INPUT","TEXTAREA","SELECT"],fe=new WeakMap;function he(e){return function(e,t){if(oe&&e.parentRule instanceof CSSGroupingRule||ae&&e.parentRule instanceof CSSMediaRule||ie&&e.parentRule instanceof CSSSupportsRule||se&&e.parentRule instanceof CSSConditionRule){var n=Array.from(e.parentRule.cssRules).indexOf(e);t.unshift(n)}else n=Array.from(e.parentStyleSheet.cssRules).indexOf(e),t.unshift(n);return t}(e,[])}function me(e,t){var n,s;void 0===t&&(t={});var l=e.doc.defaultView;if(!l)return function(){};!function(e,t){var n=e.mutationCb,r=e.mousemoveCb,o=e.mouseInteractionCb,s=e.scrollCb,u=e.viewportResizeCb,l=e.inputCb,c=e.mediaInteractionCb,d=e.styleSheetRuleCb,p=e.styleDeclarationCb,f=e.canvasMutationCb,h=e.fontCb;e.mutationCb=function(){for(var e=[],r=0;r<arguments.length;r++)e[r]=arguments[r];t.mutation&&t.mutation.apply(t,i([],a(e),!1)),n.apply(void 0,i([],a(e),!1))},e.mousemoveCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mousemove&&t.mousemove.apply(t,i([],a(e),!1)),r.apply(void 0,i([],a(e),!1))},e.mouseInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mouseInteraction&&t.mouseInteraction.apply(t,i([],a(e),!1)),o.apply(void 0,i([],a(e),!1))},e.scrollCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.scroll&&t.scroll.apply(t,i([],a(e),!1)),s.apply(void 0,i([],a(e),!1))},e.viewportResizeCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.viewportResize&&t.viewportResize.apply(t,i([],a(e),!1)),u.apply(void 0,i([],a(e),!1))},e.inputCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.input&&t.input.apply(t,i([],a(e),!1)),l.apply(void 0,i([],a(e),!1))},e.mediaInteractionCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.mediaInteaction&&t.mediaInteaction.apply(t,i([],a(e),!1)),c.apply(void 0,i([],a(e),!1))},e.styleSheetRuleCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleSheetRule&&t.styleSheetRule.apply(t,i([],a(e),!1)),d.apply(void 0,i([],a(e),!1))},e.styleDeclarationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.styleDeclaration&&t.styleDeclaration.apply(t,i([],a(e),!1)),p.apply(void 0,i([],a(e),!1))},e.canvasMutationCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.canvasMutation&&t.canvasMutation.apply(t,i([],a(e),!1)),f.apply(void 0,i([],a(e),!1))},e.fontCb=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];t.font&&t.font.apply(t,i([],a(e),!1)),h.apply(void 0,i([],a(e),!1))}}(e,t);var c=le(e,e.doc),d=function(e){var t=e.mousemoveCb,n=e.sampling,r=e.doc,o=e.mirror;if(!1===n.mousemove)return function(){};var a,i="number"==typeof n.mousemove?n.mousemove:50,s="number"==typeof n.mousemoveCallback?n.mousemoveCallback:500,u=[],l=z((function(e){var n=Date.now()-a;t(u.map((function(e){return e.timeOffset-=n,e})),e),u=[],a=null}),s),c=z((function(e){var t=ue(e),n=B(e)?e.changedTouches[0]:e,r=n.clientX,i=n.clientY;a||(a=Date.now()),u.push({x:r,y:i,id:o.getId(t),timeOffset:Date.now()-a}),l("undefined"!=typeof DragEvent&&e instanceof DragEvent?R.Drag:e instanceof MouseEvent?R.MouseMove:R.TouchMove)}),i,{trailing:!1}),d=[F("mousemove",c,r),F("touchmove",c,r),F("drag",c,r)];return function(){d.forEach((function(e){return e()}))}}(e),p=function(e){var t=e.mouseInteractionCb,n=e.doc,r=e.mirror,o=e.blockClass,a=e.sampling;if(!1===a.mouseInteraction)return function(){};var i=!0===a.mouseInteraction||void 0===a.mouseInteraction?{}:a.mouseInteraction,s=[];return Object.keys(N).filter((function(e){return Number.isNaN(Number(e))&&!e.endsWith("_Departed")&&!1!==i[e]})).forEach((function(e){var a=e.toLowerCase(),i=function(e){return function(n){var a=ue(n);if(!H(a,o)){var i=B(n)?n.changedTouches[0]:n;if(i){var s=r.getId(a),u=i.clientX,l=i.clientY;t({type:N[e],id:s,x:u,y:l})}}}}(e);s.push(F(a,i,n))})),function(){s.forEach((function(e){return e()}))}}(e),f=ce(e),h=function(e){var t=e.viewportResizeCb,n=-1,r=-1;return F("resize",z((function(){var e=U(),o=G();n===e&&r===o||(t({width:Number(o),height:Number(e)}),n=e,r=o)}),200),window)}(e),m=function(e){var t=e.inputCb,n=e.doc,o=e.mirror,s=e.blockClass,l=e.ignoreClass,c=e.maskInputOptions,d=e.maskInputFn,p=e.sampling,f=e.userTriggeredOnInput;function h(e){var t=ue(e),r=e.isTrusted;if(t&&"OPTION"===t.tagName&&(t=t.parentElement),t&&t.tagName&&!(pe.indexOf(t.tagName)<0)&&!H(t,s)){var o=t.type;if(!t.classList.contains(l)){var a=t.value,i=!1;"radio"===o||"checkbox"===o?i=t.checked:(c[t.tagName.toLowerCase()]||c[o])&&(a=u({maskInputOptions:c,tagName:t.tagName,type:o,value:a,maskInputFn:d})),m(t,de({text:a,isChecked:i,userTriggered:r},f));var p=t.name;"radio"===o&&p&&i&&n.querySelectorAll('input[type="radio"][name="'.concat(p,'"]')).forEach((function(e){e!==t&&m(e,de({text:e.value,isChecked:!i,userTriggered:!1},f))}))}}}function m(e,n){var a=fe.get(e);if(!a||a.text!==n.text||a.isChecked!==n.isChecked){fe.set(e,n);var i=o.getId(e);t(r(r({},n),{id:i}))}}var v=("last"===p.input?["change"]:["input","change"]).map((function(e){return F(e,h,n)})),y=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value"),g=[[HTMLInputElement.prototype,"value"],[HTMLInputElement.prototype,"checked"],[HTMLSelectElement.prototype,"value"],[HTMLTextAreaElement.prototype,"value"],[HTMLSelectElement.prototype,"selectedIndex"],[HTMLOptionElement.prototype,"selected"]];return y&&y.set&&v.push.apply(v,i([],a(g.map((function(e){return W(e[0],e[1],{set:function(){h({target:this})}})}))),!1)),function(){v.forEach((function(e){return e()}))}}(e),v=function(e){var t=e.mediaInteractionCb,n=e.blockClass,r=e.mirror,o=e.sampling,a=function(e){return z((function(o){var a=ue(o);if(a&&!H(a,n)){var i=a,s=i.currentTime,u=i.volume,l=i.muted;t({type:e,id:r.getId(a),currentTime:s,volume:u,muted:l})}}),o.media||500)},i=[F("play",a(0)),F("pause",a(1)),F("seeked",a(2)),F("volumechange",a(3))];return function(){i.forEach((function(e){return e()}))}}(e),y=function(e,t){var n=e.styleSheetRuleCb,r=e.mirror,o=t.win,s=o.CSSStyleSheet.prototype.insertRule;o.CSSStyleSheet.prototype.insertRule=function(e,t){var o=r.getId(this.ownerNode);return-1!==o&&n({id:o,adds:[{rule:e,index:t}]}),s.apply(this,arguments)};var u=o.CSSStyleSheet.prototype.deleteRule;o.CSSStyleSheet.prototype.deleteRule=function(e){var t=r.getId(this.ownerNode);return-1!==t&&n({id:t,removes:[{index:e}]}),u.apply(this,arguments)};var l={};oe?l.CSSGroupingRule=o.CSSGroupingRule:(ae&&(l.CSSMediaRule=o.CSSMediaRule),se&&(l.CSSConditionRule=o.CSSConditionRule),ie&&(l.CSSSupportsRule=o.CSSSupportsRule));var c={};return Object.entries(l).forEach((function(e){var t=a(e,2),o=t[0],s=t[1];c[o]={insertRule:s.prototype.insertRule,deleteRule:s.prototype.deleteRule},s.prototype.insertRule=function(e,t){var s=r.getId(this.parentStyleSheet.ownerNode);return-1!==s&&n({id:s,adds:[{rule:e,index:i(i([],a(he(this)),!1),[t||0],!1)}]}),c[o].insertRule.apply(this,arguments)},s.prototype.deleteRule=function(e){var t=r.getId(this.parentStyleSheet.ownerNode);return-1!==t&&n({id:t,removes:[{index:i(i([],a(he(this)),!1),[e],!1)}]}),c[o].deleteRule.apply(this,arguments)}})),function(){o.CSSStyleSheet.prototype.insertRule=s,o.CSSStyleSheet.prototype.deleteRule=u,Object.entries(l).forEach((function(e){var t=a(e,2),n=t[0],r=t[1];r.prototype.insertRule=c[n].insertRule,r.prototype.deleteRule=c[n].deleteRule}))}}(e,{win:l}),g=function(e,t){var n=e.styleDeclarationCb,r=e.mirror,o=t.win,a=o.CSSStyleDeclaration.prototype.setProperty;o.CSSStyleDeclaration.prototype.setProperty=function(e,t,o){var i,s,u=r.getId(null===(s=null===(i=this.parentRule)||void 0===i?void 0:i.parentStyleSheet)||void 0===s?void 0:s.ownerNode);return-1!==u&&n({id:u,set:{property:e,value:t,priority:o},index:he(this.parentRule)}),a.apply(this,arguments)};var i=o.CSSStyleDeclaration.prototype.removeProperty;return o.CSSStyleDeclaration.prototype.removeProperty=function(e){var t,o,a=r.getId(null===(o=null===(t=this.parentRule)||void 0===t?void 0:t.parentStyleSheet)||void 0===o?void 0:o.ownerNode);return-1!==a&&n({id:a,remove:{property:e},index:he(this.parentRule)}),i.apply(this,arguments)},function(){o.CSSStyleDeclaration.prototype.setProperty=a,o.CSSStyleDeclaration.prototype.removeProperty=i}}(e,{win:l}),b=e.collectFonts?function(e){var t=e.fontCb,n=e.doc,r=n.defaultView;if(!r)return function(){};var o=[],a=new WeakMap,i=r.FontFace;r.FontFace=function(e,t,n){var r=new i(e,t,n);return a.set(r,{family:e,buffer:"string"!=typeof t,descriptors:n,fontSource:"string"==typeof t?t:JSON.stringify(Array.from(new Uint8Array(t)))}),r};var s=j(n.fonts,"add",(function(e){return function(n){return setTimeout((function(){var e=a.get(n);e&&(t(e),a.delete(n))}),0),e.apply(this,[n])}}));return o.push((function(){r.FontFace=i})),o.push(s),function(){o.forEach((function(e){return e()}))}}(e):function(){},S=[];try{for(var C=o(e.plugins),k=C.next();!k.done;k=C.next()){var w=k.value;S.push(w.observer(w.callback,l,w.options))}}catch(e){n={error:e}}finally{try{k&&!k.done&&(s=C.return)&&s.call(C)}finally{if(n)throw n.error}}return function(){re.forEach((function(e){return e.reset()})),c.disconnect(),d(),p(),f(),h(),m(),v(),y(),g(),b(),S.forEach((function(e){return e()}))}}var ve=function(){function e(e){this.iframes=new WeakMap,this.mutationCb=e.mutationCb}return e.prototype.addIframe=function(e){this.iframes.set(e,!0)},e.prototype.addLoadListener=function(e){this.loadListener=e},e.prototype.attachIframe=function(e,t){var n;this.mutationCb({adds:[{parentId:e.__sn.id,nextId:null,node:t}],removes:[],texts:[],attributes:[],isAttachIframe:!0}),null===(n=this.loadListener)||void 0===n||n.call(this,e)},e}(),ye=function(){function e(e){this.restorePatches=[],this.mutationCb=e.mutationCb,this.scrollCb=e.scrollCb,this.bypassOptions=e.bypassOptions,this.mirror=e.mirror;var t=this;this.restorePatches.push(j(HTMLElement.prototype,"attachShadow",(function(e){return function(){var n=e.apply(this,arguments);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,this.ownerDocument),n}})))}return e.prototype.addShadowRoot=function(e,t){le(r(r({},this.bypassOptions),{doc:t,mutationCb:this.mutationCb,mirror:this.mirror,shadowDomManager:this}),e),ce(r(r({},this.bypassOptions),{scrollCb:this.scrollCb,doc:e,mirror:this.mirror}))},e.prototype.observeAttachShadow=function(e){if(e.contentWindow){var t=this;this.restorePatches.push(j(e.contentWindow.HTMLElement.prototype,"attachShadow",(function(n){return function(){var r=n.apply(this,arguments);return this.shadowRoot&&t.addShadowRoot(this.shadowRoot,e.contentDocument),r}})))}},e.prototype.reset=function(){this.restorePatches.forEach((function(e){return e()}))},e}();for(var ge="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",be="undefined"==typeof Uint8Array?[]:new Uint8Array(256),Se=0;Se<ge.length;Se++)be[ge.charCodeAt(Se)]=Se;var Ce=function(e){var t,n=new Uint8Array(e),r=n.length,o="";for(t=0;t<r;t+=3)o+=ge[n[t]>>2],o+=ge[(3&n[t])<<4|n[t+1]>>4],o+=ge[(15&n[t+1])<<2|n[t+2]>>6],o+=ge[63&n[t+2]];return r%3==2?o=o.substring(0,o.length-1)+"=":r%3==1&&(o=o.substring(0,o.length-2)+"=="),o},ke=new Map,we=function(e,t,n){if(e&&(Me(e,t)||"object"==typeof e)){var r=function(e,t){var n=ke.get(e);return n||(n=new Map,ke.set(e,n)),n.has(t)||n.set(t,[]),n.get(t)}(n,e.constructor.name),o=r.indexOf(e);return-1===o&&(o=r.length,r.push(e)),o}};function Ie(e,t,n){return e instanceof Array?e.map((function(e){return Ie(e,t,n)})):null===e?e:e instanceof Float32Array||e instanceof Float64Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8Array||e instanceof Uint16Array||e instanceof Int16Array||e instanceof Int8Array||e instanceof Uint8ClampedArray?{rr_type:e.constructor.name,args:[Object.values(e)]}:e instanceof ArrayBuffer?{rr_type:e.constructor.name,base64:Ce(e)}:e instanceof DataView?{rr_type:e.constructor.name,args:[Ie(e.buffer,t,n),e.byteOffset,e.byteLength]}:e instanceof HTMLImageElement?{rr_type:e.constructor.name,src:e.src}:e instanceof ImageData?{rr_type:e.constructor.name,args:[Ie(e.data,t,n),e.width,e.height]}:Me(e,t)||"object"==typeof e?{rr_type:e.constructor.name,index:we(e,t,n)}:e}var xe=function(e,t,n){return i([],a(e),!1).map((function(e){return Ie(e,t,n)}))},Me=function(e,t){var n=["WebGLActiveInfo","WebGLBuffer","WebGLFramebuffer","WebGLProgram","WebGLRenderbuffer","WebGLShader","WebGLShaderPrecisionFormat","WebGLTexture","WebGLUniformLocation","WebGLVertexArrayObject","WebGLVertexArrayObjectOES"].filter((function(e){return"function"==typeof t[e]}));return Boolean(n.find((function(n){return e instanceof t[n]})))};function Te(e,t,n,r,s,u){var l,c,d=[],p=Object.getOwnPropertyNames(e),f=function(o){try{if("function"!=typeof e[o])return"continue";var l=j(e,o,(function(l){return function(){for(var c=[],d=0;d<arguments.length;d++)c[d]=arguments[d];var p=l.apply(this,c);if(we(p,u,e),!H(this.canvas,r)){s.getId(this.canvas);var f=xe(i([],a(c),!1),u,e),h={type:t,property:o,args:f};n(this.canvas,h)}return p}}));d.push(l)}catch(r){var c=W(e,o,{set:function(e){n(this.canvas,{type:t,property:o,args:[e],setter:!0})}});d.push(c)}};try{for(var h=o(p),m=h.next();!m.done;m=h.next())f(m.value)}catch(e){l={error:e}}finally{try{m&&!m.done&&(c=h.return)&&c.call(h)}finally{if(l)throw l.error}}return d}var Ee,Oe,Re=function(){function e(e){this.pendingCanvasMutations=new Map,this.rafStamps={latestId:0,invokeId:null},this.frozen=!1,this.locked=!1,this.processMutation=function(e,t){!(this.rafStamps.invokeId&&this.rafStamps.latestId!==this.rafStamps.invokeId)&&this.rafStamps.invokeId||(this.rafStamps.invokeId=this.rafStamps.latestId),this.pendingCanvasMutations.has(e)||this.pendingCanvasMutations.set(e,[]),this.pendingCanvasMutations.get(e).push(t)},this.mutationCb=e.mutationCb,this.mirror=e.mirror,!0===e.recordCanvas&&this.initCanvasMutationObserver(e.win,e.blockClass)}return e.prototype.reset=function(){this.pendingCanvasMutations.clear(),this.resetObservers&&this.resetObservers()},e.prototype.freeze=function(){this.frozen=!0},e.prototype.unfreeze=function(){this.frozen=!1},e.prototype.lock=function(){this.locked=!0},e.prototype.unlock=function(){this.locked=!1},e.prototype.initCanvasMutationObserver=function(e,t){this.startRAFTimestamping(),this.startPendingCanvasMutationFlusher();var n=function(e,t){var n=[];try{var r=j(e.HTMLCanvasElement.prototype,"getContext",(function(e){return function(n){for(var r=[],o=1;o<arguments.length;o++)r[o-1]=arguments[o];return H(this,t)||"__context"in this||(this.__context=n),e.apply(this,i([n],a(r),!1))}}));n.push(r)}catch(e){console.error("failed to patch HTMLCanvasElement.prototype.getContext")}return function(){n.forEach((function(e){return e()}))}}(e,t),r=function(e,t,n,r){var s,u,l=[],c=Object.getOwnPropertyNames(t.CanvasRenderingContext2D.prototype),d=function(r){try{if("function"!=typeof t.CanvasRenderingContext2D.prototype[r])return"continue";var o=j(t.CanvasRenderingContext2D.prototype,r,(function(t){return function(){for(var o=this,s=[],u=0;u<arguments.length;u++)s[u]=arguments[u];return H(this.canvas,n)||setTimeout((function(){var t=i([],a(s),!1);if("drawImage"===r&&t[0]&&t[0]instanceof HTMLCanvasElement){var n=t[0],u=n.getContext("2d"),l=null==u?void 0:u.getImageData(0,0,n.width,n.height),c=null==l?void 0:l.data;t[0]=JSON.stringify(c)}e(o.canvas,{type:_["2D"],property:r,args:t})}),0),t.apply(this,s)}}));l.push(o)}catch(n){var s=W(t.CanvasRenderingContext2D.prototype,r,{set:function(t){e(this.canvas,{type:_["2D"],property:r,args:[t],setter:!0})}});l.push(s)}};try{for(var p=o(c),f=p.next();!f.done;f=p.next())d(f.value)}catch(e){s={error:e}}finally{try{f&&!f.done&&(u=p.return)&&u.call(p)}finally{if(s)throw s.error}}return function(){l.forEach((function(e){return e()}))}}(this.processMutation.bind(this),e,t,this.mirror),s=function(e,t,n,r){var o=[];return o.push.apply(o,i([],a(Te(t.WebGLRenderingContext.prototype,_.WebGL,e,n,r,t)),!1)),void 0!==t.WebGL2RenderingContext&&o.push.apply(o,i([],a(Te(t.WebGL2RenderingContext.prototype,_.WebGL2,e,n,r,t)),!1)),function(){o.forEach((function(e){return e()}))}}(this.processMutation.bind(this),e,t,this.mirror);this.resetObservers=function(){n(),r(),s()}},e.prototype.startPendingCanvasMutationFlusher=function(){var e=this;requestAnimationFrame((function(){return e.flushPendingCanvasMutations()}))},e.prototype.startRAFTimestamping=function(){var e=this,t=function(n){e.rafStamps.latestId=n,requestAnimationFrame(t)};requestAnimationFrame(t)},e.prototype.flushPendingCanvasMutations=function(){var e=this;this.pendingCanvasMutations.forEach((function(t,n){var r=e.mirror.getId(n);e.flushPendingCanvasMutationFor(n,r)})),requestAnimationFrame((function(){return e.flushPendingCanvasMutations()}))},e.prototype.flushPendingCanvasMutationFor=function(e,t){if(!this.frozen&&!this.locked){var n=this.pendingCanvasMutations.get(e);if(n&&-1!==t){var r=n.map((function(e){e.type;var t=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(e,["type"]);return t})),o=n[0].type;this.mutationCb({id:t,type:o,commands:r}),this.pendingCanvasMutations.delete(e)}}},e}();function Ne(e){return r(r({},e),{timestamp:Date.now()})}var _e={map:{},getId:function(e){return e&&e.__sn?e.__sn.id:-1},getNode:function(e){return this.map[e]||null},removeNodeFromMap:function(e){var t=this,n=e.__sn&&e.__sn.id;delete this.map[n],e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},has:function(e){return this.map.hasOwnProperty(e)},reset:function(){this.map={}}};function Le(e){void 0===e&&(e={});var t=e.emit,n=e.checkoutEveryNms,i=e.checkoutEveryNth,s=e.blockClass,u=void 0===s?"rr-block":s,l=e.blockSelector,c=void 0===l?null:l,d=e.ignoreClass,p=void 0===d?"rr-ignore":d,f=e.maskTextClass,h=void 0===f?"rr-mask":f,m=e.maskTextSelector,v=void 0===m?null:m,y=e.inlineStylesheet,g=void 0===y||y,b=e.maskAllInputs,S=e.maskInputOptions,C=e.slimDOMOptions,k=e.maskInputFn,w=e.maskTextFn,I=e.hooks,x=e.packFn,M=e.sampling,T=void 0===M?{}:M,N=e.mousemoveWait,_=e.recordCanvas,L=void 0!==_&&_,D=e.userTriggeredOnInput,A=void 0!==D&&D,P=e.collectFonts,z=void 0!==P&&P,W=e.inlineImages,j=void 0!==W&&W,H=e.plugins,V=e.keepIframeSrcFn,q=void 0===V?function(){return!1}:V;if(!t)throw new Error("emit function is required");void 0!==N&&void 0===T.mousemove&&(T.mousemove=N);var B,K,J=!0===b?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:void 0!==S?S:{password:!0},Z=!0===C||"all"===C?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaVerification:!0,headMetaAuthorship:"all"===C,headMetaDescKeywords:"all"===C}:C||{};void 0===B&&(B=window),"NodeList"in B&&!B.NodeList.prototype.forEach&&(B.NodeList.prototype.forEach=Array.prototype.forEach),"DOMTokenList"in B&&!B.DOMTokenList.prototype.forEach&&(B.DOMTokenList.prototype.forEach=Array.prototype.forEach),Node.prototype.contains||(Node.prototype.contains=function(e){if(!(0 in arguments))throw new TypeError("1 argument is required");do{if(this===e)return!0}while(e=e&&e.parentNode);return!1});var $=0;Ee=function(e,r){var a;if(!(null===(a=re[0])||void 0===a?void 0:a.isFrozen())||e.type===O.FullSnapshot||e.type===O.IncrementalSnapshot&&e.data.source===R.Mutation||re.forEach((function(e){return e.unfreeze()})),t(function(e){var t,n;try{for(var r=o(H||[]),a=r.next();!a.done;a=r.next()){var i=a.value;i.eventProcessor&&(e=i.eventProcessor(e))}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return x&&(e=x(e)),e}(e),r),e.type===O.FullSnapshot)K=e,$=0;else if(e.type===O.IncrementalSnapshot){if(e.data.source===R.Mutation&&e.data.isAttachIframe)return;$++;var s=i&&$>=i,u=n&&e.timestamp-K.timestamp>n;(s||u)&&Oe(!0)}};var Q=function(e){Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.Mutation},e)}))},ee=function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.Scroll},e)}))},te=function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.CanvasMutation},e)}))},ne=new ve({mutationCb:Q}),oe=new Re({recordCanvas:L,mutationCb:te,win:window,blockClass:u,mirror:_e}),ae=new ye({mutationCb:Q,scrollCb:ee,bypassOptions:{blockClass:u,blockSelector:c,maskTextClass:h,maskTextSelector:v,inlineStylesheet:g,maskInputOptions:J,maskTextFn:w,maskInputFn:k,recordCanvas:L,inlineImages:j,sampling:T,slimDOMOptions:Z,iframeManager:ne,canvasManager:oe},mirror:_e});Oe=function(e){var t,n,r,o;void 0===e&&(e=!1),Ee(Ne({type:O.Meta,data:{href:window.location.href,width:G(),height:U()}}),e),re.forEach((function(e){return e.lock()}));var i=a(function(e,t){var n=t||{},r=n.blockClass,o=n.blockSelector,a=n.maskTextClass,i=n.maskTextSelector,s=n.inlineStylesheet,u=n.inlineImages,l=n.recordCanvas,c=n.maskAllInputs,d=void 0!==c&&c,p=n.slimDOM,f=void 0!==p&&p,h=n.keepIframeSrcFn,m={};return[E(e,{doc:e,map:m,blockClass:void 0===r?"rr-block":r,blockSelector:void 0===o?null:o,maskTextClass:void 0===a?"rr-mask":a,maskTextSelector:void 0===i?null:i,skipChild:!1,inlineStylesheet:void 0===s||s,maskInputOptions:!0===d?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===d?{password:!0}:d,maskTextFn:n.maskTextFn,maskInputFn:n.maskInputFn,slimDOMOptions:!0===f||"all"===f?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===f,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===f?{}:f,dataURLOptions:n.dataURLOptions,inlineImages:void 0!==u&&u,recordCanvas:void 0!==l&&l,preserveWhiteSpace:n.preserveWhiteSpace,onSerialize:n.onSerialize,onIframeLoad:n.onIframeLoad,iframeLoadTimeout:n.iframeLoadTimeout,keepIframeSrcFn:void 0===h?function(){return!1}:h}),m]}(document,{blockClass:u,blockSelector:c,maskTextClass:h,maskTextSelector:v,inlineStylesheet:g,maskAllInputs:J,maskTextFn:w,slimDOM:Z,recordCanvas:L,inlineImages:j,onSerialize:function(e){X(e)&&ne.addIframe(e),Y(e)&&ae.addShadowRoot(e.shadowRoot,document)},onIframeLoad:function(e,t){ne.attachIframe(e,t),ae.observeAttachShadow(e)},keepIframeSrcFn:q}),2),s=i[0],l=i[1];if(!s)return console.warn("Failed to snapshot the document");_e.map=l,Ee(Ne({type:O.FullSnapshot,data:{node:s,initialOffset:{left:void 0!==window.pageXOffset?window.pageXOffset:(null===document||void 0===document?void 0:document.documentElement.scrollLeft)||(null===(n=null===(t=null===document||void 0===document?void 0:document.body)||void 0===t?void 0:t.parentElement)||void 0===n?void 0:n.scrollLeft)||(null===document||void 0===document?void 0:document.body.scrollLeft)||0,top:void 0!==window.pageYOffset?window.pageYOffset:(null===document||void 0===document?void 0:document.documentElement.scrollTop)||(null===(o=null===(r=null===document||void 0===document?void 0:document.body)||void 0===r?void 0:r.parentElement)||void 0===o?void 0:o.scrollTop)||(null===document||void 0===document?void 0:document.body.scrollTop)||0}}})),re.forEach((function(e){return e.unlock()}))};try{var ie=[];ie.push(F("DOMContentLoaded",(function(){Ee(Ne({type:O.DomContentLoaded,data:{}}))})));var se=function(e){var t;return me({mutationCb:Q,mousemoveCb:function(e,t){return Ee(Ne({type:O.IncrementalSnapshot,data:{source:t,positions:e}}))},mouseInteractionCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.MouseInteraction},e)}))},scrollCb:ee,viewportResizeCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.ViewportResize},e)}))},inputCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.Input},e)}))},mediaInteractionCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.MediaInteraction},e)}))},styleSheetRuleCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.StyleSheetRule},e)}))},styleDeclarationCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.StyleDeclaration},e)}))},canvasMutationCb:te,fontCb:function(e){return Ee(Ne({type:O.IncrementalSnapshot,data:r({source:R.Font},e)}))},blockClass:u,ignoreClass:p,maskTextClass:h,maskTextSelector:v,maskInputOptions:J,inlineStylesheet:g,sampling:T,recordCanvas:L,inlineImages:j,userTriggeredOnInput:A,collectFonts:z,doc:e,maskInputFn:k,maskTextFn:w,blockSelector:c,slimDOMOptions:Z,mirror:_e,iframeManager:ne,shadowDomManager:ae,canvasManager:oe,plugins:(null===(t=null==H?void 0:H.filter((function(e){return e.observer})))||void 0===t?void 0:t.map((function(e){return{observer:e.observer,options:e.options,callback:function(t){return Ee(Ne({type:O.Plugin,data:{plugin:e.name,payload:t}}))}}})))||[]},I)};ne.addLoadListener((function(e){ie.push(se(e.contentDocument))}));var ue=function(){Oe(),ie.push(se(document))};return"interactive"===document.readyState||"complete"===document.readyState?ue():ie.push(F("load",(function(){Ee(Ne({type:O.Load,data:{}})),ue()}),window)),function(){ie.forEach((function(e){return e()}))}}catch(e){console.warn(e)}}Le.addCustomEvent=function(e,t){if(!Ee)throw new Error("please add custom event after start recording");Ee(Ne({type:O.Custom,data:{tag:e,payload:t}}))},Le.freezePage=function(){re.forEach((function(e){return e.freeze()}))},Le.takeFullSnapshot=function(e){if(!Oe)throw new Error("please take full snapshot after start recording");Oe(e)},Le.mirror=_e;const De=Le;var Fe=null,Ae=[];const Pe={start:function(){setTimeout((function(){console.log("写network事件"),De.addCustomEvent("xhr-log",{type:"XMLHttpRequest",url:"/api/v1",endTime:Date.now()})}),2e3),Fe=De({emit:function(e){Ae.push(e)},plugins:[]})},get:function(){return Ae},stop:function(){Fe&&Fe()}};return t})()));